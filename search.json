[{"title":"Hello world","url":"/2021/09/28/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\nQuick StartCreate a new post$ hexo new &quot;My New Post&quot;\n\nMore info: Writing\nRun server$ hexo server\n\nMore info: Server\nGenerate static files$ hexo generate\n\nMore info: Generating\nDeploy to remote sites$ hexo deploy\n\nMore info: Deployment\n"},{"title":"iOSä¸­allocå’Œnewçš„æœ¬è´¨","url":"/2021/09/29/iOS%E4%B8%ADalloc%E5%92%8Cnew%E7%9A%84%E6%9C%AC%E8%B4%A8/","content":"iOSä¸­çš„allocå’Œnew\nå…„å¼Ÿä»¬allocç»å¸¸ä¼šç”¨åˆ°ã€‚ä»Šå¤©çœ‹çœ‹ objcæºç  ä¸­æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼ˆæˆ‘ç”¨çš„æ˜¯ objc818 çš„ï¼Œåº”è¯¥æ˜¯æ¯”ä»·æ–°çš„äº†ï¼‰\n\nå…·ä½“å¦‚ä½•ä½¿ æºç ç¼–è¯‘,å¯ä»¥ç§»æ­¥æˆ‘çš„æ˜é‡‘åšå®¢æºç ç¼–è¯‘é…ç½® ï¼ˆå¯ä»¥çš„è¯ç‚¹ä¸ªå°èµæœ€å¥½äº†ğŸ¤Ÿï¼‰\n\n\nalloc åº•å±‚åŸç†allocæ ¸å¿ƒä»£ç å®šä½\nç›´æ¥æèµ·äº†~  é¦–å…ˆå†™è¡Œä»£ç \n\nXGPerson * person = [[XGPerson alloc] init];\n\n\næˆ‘ä»¬å¯ä»¥æ‰“æ–­ç‚¹ï¼Œç„¶åè·Ÿè¿›ä»–çš„æºç ï¼Œçœ‹çœ‹ä»–çš„æ­¥éª¤ï¼Œç„¶åå®šä½æ ¸å¿ƒä»£ç \n\n\nå°è°·å·å·çš„ç”»äº†ä¸€æ³¢å›¾\n\n\n\næˆ‘ä»¬å®šä½åˆ°çš„ä»£ç  ~\n\nstatic ALWAYS_INLINE id_class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone,                              int construct_flags = OBJECT_CONSTRUCT_NONE,                              bool cxxConstruct = true,                              size_t *outAllocatedSize = nil)&#123;    ASSERT(cls-&gt;isRealized());    // Read class&#x27;s info bits all at once for performance    bool hasCxxCtor = cxxConstruct &amp;&amp; cls-&gt;hasCxxCtor();    bool hasCxxDtor = cls-&gt;hasCxxDtor();    bool fast = cls-&gt;canAllocNonpointer();    size_t size;    size = cls-&gt;instanceSize(extraBytes);    if (outAllocatedSize) *outAllocatedSize = size;    id obj;    if (zone) &#123;        obj = (id)malloc_zone_calloc((malloc_zone_t *)zone, 1, size);    &#125; else &#123;        obj = (id)calloc(1, size);    &#125;    if (slowpath(!obj)) &#123;        if (construct_flags &amp; OBJECT_CONSTRUCT_CALL_BADALLOC) &#123;            return _objc_callBadAllocHandler(cls);        &#125;        return nil;    &#125;    if (!zone &amp;&amp; fast) &#123;        obj-&gt;initInstanceIsa(cls, hasCxxDtor);    &#125; else &#123;        // Use raw pointer isa on the assumption that they might be        // doing something weird with the zone or RR.        obj-&gt;initIsa(cls);    &#125;    if (fastpath(!hasCxxCtor)) &#123;        return obj;    &#125;    construct_flags |= OBJECT_CONSTRUCT_FREE_ONFAILURE;    return object_cxxConstructFromClass(obj, cls, construct_flags);&#125;\n\nallocæ ¸å¿ƒä»£ç æ¢ç©¶\nå…ˆæ¥ä¸€æ³¢ç®€å•çš„å›¾ç‰‡æ³¨é‡Šè¯´æ˜\n\n\n\né€šè¿‡ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ã€‚allocä¸»è¦æ˜¯3æ­¥æ“ä½œ\n\nè®¡ç®—æ‰€è¦å¼€è¾Ÿå†…å­˜çš„å¤§å°\nå¼€è¾Ÿå†…å­˜ç©ºé—´\nå°†å¼€è¾Ÿçš„ç©ºé—´å’Œisaå…³è”èµ·æ¥ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„å¯¹è±¡äº†ï¼‰\n\n\næˆ‘ä»¬æ¥çœ‹ä¸‹ å¼€è¾Ÿå†…å­˜å¤§å°çš„æ–¹æ³•\ninline size_t instanceSize(size_t extraBytes) const &#123;\t//å¦‚æœå·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œç›´æ¥åœ¨cache ä¸­å–       if (fastpath(cache.hasFastInstanceSize(extraBytes))) &#123;           return cache.fastInstanceSize(extraBytes);       &#125;       size_t size = alignedInstanceSize() + extraBytes;       // CF requires all objects be at least 16 bytes.       if (size &lt; 16) size = 16;       return size;   &#125;\n\næˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä»–ä½¿ç”¨çš„æ˜¯16å­—èŠ‚å¯¹é½ã€‚\n\n\næˆ‘ä»¬å†æ¥ç ”ç©¶ä¸‹ï¼šå¦‚ä½•æŠŠå†…å­˜å…³è”èµ·æ¥çš„ã€‚\n\n\ninline void objc_object::initIsa(Class cls, bool nonpointer, UNUSED_WITHOUT_INDEXED_ISA_AND_DTOR_BIT bool hasCxxDtor)&#123;     ASSERT(!isTaggedPointer());         isa_t newisa(0);    if (!nonpointer) &#123;        newisa.setClass(cls, this);    &#125; else &#123;        ASSERT(!DisableNonpointerIsa);        ASSERT(!cls-&gt;instancesRequireRawIsa());#if SUPPORT_INDEXED_ISA        ASSERT(cls-&gt;classArrayIndex() &gt; 0);        newisa.bits = ISA_INDEX_MAGIC_VALUE;        // isa.magic is part of ISA_MAGIC_VALUE        // isa.nonpointer is part of ISA_MAGIC_VALUE        newisa.has_cxx_dtor = hasCxxDtor;        newisa.indexcls = (uintptr_t)cls-&gt;classArrayIndex();#else        newisa.bits = ISA_MAGIC_VALUE;        // isa.magic is part of ISA_MAGIC_VALUE        // isa.nonpointer is part of ISA_MAGIC_VALUE#   if ISA_HAS_CXX_DTOR_BIT        newisa.has_cxx_dtor = hasCxxDtor;#   endif        newisa.setClass(cls, this);#endif        newisa.extra_rc = 1;    &#125;    // This write must be performed in a single store in some cases    // (for example when realizing a class because other threads    // may simultaneously try to use the class).    // fixme use atomics here to guarantee single-store and to    // guarantee memory order w.r.t. the class index table    // ...but not too atomic because we don&#x27;t want to hurt instantiation    isa = newisa;&#125;\n\nè¿™å°±ç›¸å½“äº å¡«å……isaäº†ã€‚ï¼ˆé‡Œé¢å…·ä½“çš„å˜é‡åç§°ã€‚æˆ‘ä¼šåœ¨isaåšå®¢çš„æ—¶å€™åœ¨å™è¿°~ï¼‰\n\n\nå…„å¼Ÿä»¬ï¼Œå·®ä¸å¤šäº†ã€‚æœ‰å¿ƒçš„å…„å¼Ÿä»¬å¯ä»¥æ€»ç»“ä¸‹allocçš„æµç¨‹å›¾ã€‚\n\nnewçš„åŸç†æ¢ç©¶new çš„æµç¨‹\n\né¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹å‡ºã€‚new ç›¸æ¯”è¾ƒ alloc å¤šå‡ºä¸€ä¸ª init\n\nnew å’Œ allocçš„åŒºåˆ«\n\nè™½ç„¶ allocWithZone ä¼ å€¼ä¸åŒï¼Œä½†æ˜¯ä»–ä¸ä¼šèµ°~  æ‰€ä»¥newæ¯”allocå•çº¯äº†å¤šäº†ä¸€ä¸ªinit\n\næ€»ç»“\nå†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ï¼Œæœ‰ç‚¹æ‡’æƒ°äº†ï¼Œå“ˆå“ˆã€‚æœ¬æ¥æƒ³å†™çš„åœ¨è¯¦ç»†ç‚¹çš„~\n\nä¸è¿‡å“ªé‡Œå†™çš„ä¸å¥½ï¼Œå…„å¼Ÿä»¬å¯ä»¥è¯„è®ºï¼Œä»¥åæˆ‘å†™çš„æ—¶å€™æˆ‘å°±ä¼šæ”¹~\n\n\n","categories":["iOSåº•å±‚æ¢ç´¢ä¹‹æ—…"],"tags":["åšå®¢ iOS åº•å±‚"]},{"title":"æˆ‘çš„ç¬¬ä¸€ç¯‡","url":"/2021/09/28/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87/","content":"åŸå› \nåŸå…ˆç»å¸¸åœ¨æ˜é‡‘ä¸Šå†™åšå®¢å‘è¡¨æ–‡ç« ã€‚ä½†æ˜¯æ¯æ¬¡åœ¨é˜…è¯»å¤§ä½¬åšå®¢çš„æ—¶å€™ï¼Œéƒ½æ˜¯æœ‰è‡ªå·±çš„åšå®¢ã€‚\n\nè¯•ç€æƒ³äº†æƒ³ï¼Œè¿˜æ˜¯è‡ªå·±æ­ä¸ªåšå®¢å§ â€“ å¿…é¡»è¦å‘å¤§ä½¬çœ‹èµ·\n\nå°è°·æˆ‘å‘¢ï¼Œå…¶å®å†™ä»£ç ä¸æ˜¯é‚£ä¹ˆçƒ­è¡·ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ç ”ç©¶ã€‚æ‰€ä»¥ä¸å†™åšå®¢æ„Ÿè§‰ä¼šæ€»æ˜¯é—å¿˜ä¸€äº›çŸ¥è¯†ç‚¹ã€‚\n\n\næ€»ç»“\nå¸Œæœ›å¯ä»¥é€šè¿‡å†™åšå®¢æ¥åŠ æ·±æ³¨æ„åŠ›ã€‚\n\nå½“ç„¶ä¸»è¦æ˜¯å¿˜è®°çš„è¯ï¼Œæœ‰ä¸ªåœ°æ–¹æŸ¥\n\nå¸Œæœ›å¤§ç‰›å¤§ä½¬å¤šå¤šæŒ‡ç‚¹ã€‚ç”±äºè¿™æ®µæ—¶é—´æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥šè‡ªå·±è¦ç ”ç©¶ä»€ä¹ˆäº†ã€‚\n\n\n"},{"title":"è”åˆä½“&ä½åŸŸ","url":"/2021/10/20/%E8%81%94%E5%90%88%E4%BD%93-%E4%BD%8D%E5%9F%9F/","content":"è”åˆä½“&amp;ä½åŸŸ\nåœ¨iOSä¸­æœ‰ä¸ªéå¸¸æœ‰åçš„ä¸œè¥¿â€“isa, ä¸çŸ¥é“å…„å¼Ÿä»¬æœ‰æ²¡æœ‰ç ”ç©¶è¿‡è¿™ä¸ªä¸œè¥¿ã€‚isaçš„ç»“æ„å°±æ˜¯é€šè¿‡è”åˆä½“å’Œä½åŸŸæ„æˆçš„ã€‚\n\nä»Šå¤©å°å°çš„ç ”ç©¶ä¸€æ³¢ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªåªéœ€è¦çœ‹æ‡‚å°±å¯ä»¥äº†ã€‚æ—¥å¸¸å¼€å‘åŸºæœ¬ç”¨ä¸åˆ°ã€‚\n\n\nè”åˆä½“\næˆ‘ä»¬å¹³å¸¸ä¼šç”¨åˆ°ä¸€ä¸ªç±»å‹æˆä¸ºç»“æ„ä½“(struct)ï¼Œæœ‰ä¸€ç§å’Œç»“æ„ä½“ç›¸ä¼¼çš„ç»“æ„ä¸ºå…±ç”¨ä½“,æˆ‘ä»¬ä¹Ÿç§°ä¸ºè”åˆä½“\n\nunion å…±ç”¨ä½“å &#123;    æˆå‘˜åˆ—è¡¨&#125;\n\n\nè”åˆä½“ ç›¸ä¼¼äº ç»“æ„ä½“ï¼Œä½†æ˜¯ä¹Ÿä¸åŒäº ç»“æ„ä½“\n\nè”åˆä½“ å’Œ ç»“æ„ä½“ çš„åŒºåˆ« 1\nç»“æ„ä½“ ä¸­æ¯ä¸ªæˆå‘˜éƒ½ç‹¬ç«‹ä¸€å—å†…å­˜ï¼Œç›¸äº’ä¸å½±å“ï¼\n\nè”åˆä½“ æ‰€æœ‰æˆå‘˜å…¬ç”¨ä¸€å—å†…å­˜ï¼ç‰µä¸€è€ŒåŠ¨å…¨èº«\n\nä¸¾ä¾‹è¯´æ˜ï¼š\n\n\nunion XGXS &#123;    int a;      //4ä¸ªå­—èŠ‚    short b;    //2ä¸ªå­—èŠ‚    char c;     //1ä¸ªå­—èŠ‚&#125; xgxs;//ç»“æœxgxs.a = 2;xgxs.b = 4;xgxs.c = &#x27;c&#x27;;NSLog(@&quot;union size: %lu - %lu&quot;,sizeof(xgxs), sizeof(union XGXS));//union size: 4 - 4\n\n å¾—å‡ºç»“è®º1ï¼šè”åˆä½“çš„å†…å­˜æ˜¯æˆå‘˜æ‰€éœ€çš„æœ€å¤§å†…å­˜é‚£ä¸ªã€‚\n\nè”åˆä½“ å’Œ ç»“æ„ä½“ çš„åŒºåˆ« 2xgxs.a = 2;NSLog(@&quot;%d---%d---%c&quot;,xgxs.a,xgxs.b,xgxs.c);//2---2---\u0002xgxs.b = 4;NSLog(@&quot;%d---%d---%c&quot;,xgxs.a,xgxs.b,xgxs.c);//4---4---\u0004xgxs.c = &#x27;c&#x27;;NSLog(@&quot;%d---%d---%c&quot;,xgxs.a,xgxs.b,xgxs.c);//99---99---c\n\n\nå¾—å‡ºç»“è®º2ï¼šæ¯æ¬¡æ”¹å˜è”åˆä½“ä¸­çš„æˆå‘˜ï¼Œå…¶ä»–æˆå‘˜ä¼šå—åˆ°å½±å“ã€å³è”åˆä½“æˆå‘˜ä¹‹é—´æ˜¯ç›¸äº’äº’æ–¥çš„\n\nä½åŸŸ\nä½åŸŸ å°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œè§åçŸ¥æ„~\n\nä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘æœ‰ä¸€è¾†æ‹–æ‹‰æœºï¼è¿™ä¸ªæ‹–æ‹‰æœºçš„æ–¹å‘åªèƒ½ å‰ã€åã€å·¦ã€å³\n\n\nä½¿ç”¨bool\nç›´æ¥ä¸Šä»£ç äº†\n\n@interface XGTractor : NSObject@property (nonatomic, assign) BOOL front;@property (nonatomic, assign) BOOL back;@property (nonatomic, assign) BOOL left;@property (nonatomic, assign) BOOL right;@end@implementation XGTractor@endXGTractor *tractor = [[XGTractor alloc] init];tractor.back = YES;tractor.front = YES;tractor.left = YES;tractor.right = YES;\n\n\næˆ‘ä»¬æ‰“å°è¿™ä¸ª tractor\n\n\n\nç„¶åæˆ‘ä»¬å‘ç°äº†ï¼šæˆ‘ä»¬å¯ä»¥çœ‹åˆ° frontã€backã€leftã€right å„å ä¸€ä¸ªå­—èŠ‚ï¼Œä½†å…¶å®æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªäºŒè¿›åˆ¶å°±å¯ä»¥è¡¨ç°å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯0æˆ– 1å°±å¯ä»¥!\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ ä½åŸŸ æ¥çœ‹ä¸€ä¸‹äº†\n\n\nä½¿ç”¨ä½åŸŸ\nä¸Šä»£ç \n\n@interface XGTractor2 : NSObject- (void)setFront:(BOOL)isFront;- (BOOL)isFront;- (void)setBack:(BOOL)isBack;- (BOOL)isBack;- (void)setLeft:(BOOL)isLeft;- (BOOL)isLeft;- (void)setRight:(BOOL)isRight;- (BOOL)isRight;@end#define XGDirectionFrontMask (1 &lt;&lt; 0)#define XGDirectionBackMask  (1 &lt;&lt; 1)#define XGDirectionLeftMask  (1 &lt;&lt; 2)#define XGDirectionRightMask (1 &lt;&lt; 3)@interface XGTractor2 () &#123;    union &#123;        char bits;        struct &#123;            char front: 1;            char back:  1;            char left:  1;            char right: 1;        &#125;;    &#125; _direction;&#125;@end@implementation XGTractor2- (instancetype)init &#123;    self = [super init];    if (self) &#123;        _direction.bits = 0b00000000;    &#125;    return self;&#125;- (void)setFront:(BOOL)isFront &#123;    _direction.front = isFront;&#125;- (BOOL)isFront &#123;    return !!(_direction.bits &amp; XGDirectionFrontMask);&#125;- (void)setBack:(BOOL)isBack &#123;    _direction.back = isBack;&#125;- (BOOL)isBack &#123;    return !!(_direction.back &amp; XGDirectionBackMask);&#125;- (void)setLeft:(BOOL)isLeft &#123;    _direction.left = isLeft;&#125;- (BOOL)isLeft &#123;    return !!(_direction.left &amp; XGDirectionLeftMask);&#125;- (void)setRight:(BOOL)isRight &#123;    _direction.right = isRight;&#125;- (BOOL)isRight &#123;    return !!(_direction.left &amp; XGDirectionLeftMask);&#125;@end\n\n\nä½¿ç”¨\n\nXGTractor2 *tr2 = [[XGTractor2 alloc] init];tr2.front = 1;tr2.back = 1;tr2.left = 1;tr2.right = 1;\n\nç„¶åæˆ‘ä»¬çœ‹ä¸‹ç»“æœ\n\n\n\nç„¶åæˆ‘ç”»äº†ä¸ªå›¾ï¼Œæ¯”è¾ƒç”ŸåŠ¨å½¢è±¡~\n\n\n\nè¿™ç§ç»“æ„å°±æ˜¯ ä½åŸŸ äº†\n\n","categories":["iOSåº•å±‚æ¢ç´¢ä¹‹æ—…"],"tags":["åšå®¢ iOS åº•å±‚"]}]